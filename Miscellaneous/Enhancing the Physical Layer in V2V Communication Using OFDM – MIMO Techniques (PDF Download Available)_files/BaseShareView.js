YUI.add("rg.views.publicliterature.PublicationIncomingCitationsListView",function(a){a.namespace("rg.views.publicliterature"),a.rg.views.publicliterature.PublicationIncomingCitationsListView=a.Base.create("publicliterature.PublicationIncomingCitationsListView",a.rg.WidgetView,[],{events:{".js-show-more":{click:"showMore"}},showMore:function(b){b&&b.preventDefault();var c={publicationUid:this.data.publicationUid,sort:this.data.sort,limit:this.data.pageSize,offset:this.data.newOffset},d=this.get("container").one(".c-list");this.get("container").one(".js-show-more").hide(),this.get("container").one(".list-loading").show(),a.rg.loadWidget(this.widgetUrl,c,function(b){var c=b.data.citationItems;this.data.pageSize=b.data.pageSize,this.data.newOffset=b.data.newOffset,this.data.hasShowMore=b.data.hasShowMore,a.Array.each(c,function(b){try{a.rg.createWidget(b,function(a){a.render({append:d})})}catch(c){a.log(c)}},this),this.data.hasShowMore&&this.get("container").one(".js-show-more").show(),this.get("container").one(".list-loading").hide()},this)}})},"1.0.0",{requires:[]});
YUI.add("rg.core.form.RgChosen",function(a){a.namespace("rg.core.form"),a.rg.core.form.RgChosen=function(b,c){if(a.UA.ie>0&&a.UA.ie<9)return!1;var d=a.one(b);return d?new Chosen(d.getDOMNode(),c):!1}},"1.0.0",{requires:["chosen"]});
"use strict";YUI.add("rg.views.publicliterature.PublicationInlineReaderView",function(a){a.namespace("rg.views.publicliterature"),a.rg.views.publicliterature.PublicationInlineReaderView=a.Base.create("publicliterature.PublicationInlineReaderView",a.rg.WidgetView,[],{events:{".js-publication-version-select":{change:"changeVersion"},".js-download":{click:"downloadPdfWithCoverPage"},".js-open-large-pdf":{click:"lazyLoadViewer"}},destructor:function(){this.messageHandler&&this.messageHandler.detach()},afterRendered:function(){var b=this,c=this.get("container"),d=new a.rg.core.layout.ResponsiveHelpers,e=c.one(".js-sticky-header");c.one(".js-social-share").plug(a.rg.header.StickyHeaderPlugin),null!==e&&d.matchesBreakpoint("s-ge")&&e.plug(a.rg.header.StickyHeaderPlugin,{}),this.trackedDownloads={},a.rg.core.form.RgChosen(".js-publication-version-select",{disable_search:!0}),this.messageHandler=a.on("pdf-js-download",function(a){b.trackDownload(a.type)});var f=c.one("iframe");if(f){var g=f.get("contentDocument").one(".pdfViewer");g&&g.delegate("click",function(a){a.preventDefault(),b.requestFulltext()},"a")}this.get("requestFulltext")&&this.requestFulltext()},requestFulltext:function(){this.get("preSignUpDialogContext")?a.rg.loadWidgetInDialog("publictopics.PreSignUpDialog.html",{context:this.get("preSignUpDialogContext")}):a.rg.loadWidgetInDialog("publicliterature.ExternalUserRequestFulltextDialog.html",{publicationUid:this.data.publicationUid,isFromPDFPromo:!0},null,null,null,null,null,null,!0)},changeVersion:function(){var b=this.get("container"),c=b.one(".js-publication-version-select option:checked"),d=b.one(".js-download"),e=b.one(".js-doi-container"),f=e.one(".js-doi"),g=b.one("iframe"),h=b.one(".file-size-note-container"),i=b.one(".js-name"),j=c.get("value");if(j){c.getAttribute("data-doi")?(e.setStyle("display","inline-block"),f.set("text",c.getAttribute("data-doi"))):e.setStyle("display","none");var k=c.getAttribute("data-viewer-url");i.set("text",c.getAttribute("data-name")),i.set("href",c.getAttribute("data-name-link")),b.one(".js-publication-date")&&b.one(".js-publication-date").set("text",c.getAttribute("data-date")),g?g._node.contentWindow.postMessage({action:"openUrl",url:k},"*"):a.rg.loadWidget(this.data.reader.widgetUrl,{fileHref:k},function(a){a.render({replaceContent:h})}),null!==d&&d.set("href",j)}},downloadPdfWithCoverPage:function(a){var b=this.get("container"),c=b.one(".js-download"),d=c.get("href");if("undefined"==typeof d||!d.length)return a.preventDefault(),!1;var e={publicationUid:this.data.publicationUid,signupPromoTemplate:this.data.signupPromoTemplate};this.data.signupPromoTemplate&&"default"!==this.data.signupPromoTemplate?(e.downloadUrl=this.data.defaultLinkData.downloadLink,e.downloadLinkSignature=this.data.defaultLinkData.downloadLinkSignature,e.authorImageUrl=this.data.authorImageUrl,this.showDownloadAndSignupPromo(e)):this.showSignupPromo(e)},showDownloadAndSignupPromo:function(b){a.rg.loadWidgetInDialog("publicliterature.FulltextDownloadedSignupDialog.html",b,null,null,null,null,null,null,!0)},showSignupPromo:function(b){this.get("showFulltextDownloadedSignupDialog")&&(this.set("showFulltextDownloadedSignupDialog",!1),a.Lang.later(1500,this,function(){a.rg.loadWidget("publicliterature.FulltextDownloadedSignupDialog.html",b,function(a){try{a.render({dialog:!0})}catch(b){}})},this))},lazyLoadViewer:function(b){var c=new a.rg.core.layout.ResponsiveHelpers;if(!c.matchesBreakpoint("s-lt")){b.preventDefault();var d=this.get("container").one(".file-size-note-container");a.rg.loadWidget(this.data.reader.widgetUrl,{},function(a){a.render({replaceContent:d})})}},trackDownload:function(b){var c=this._getDisplayedPublication(),d="v";switch(b){case"pagechange":d="v";break;case"download":d="d"}var e=this.data.trackedDownloads[c.linkId][d];e||(this.data.trackedDownloads[c.linkId][d]=!0,a.rg.ajax(this.data.downloadTrackUrl,{type:b,linkId:c.linkId,pubId:this.data.publicationUid},function(a){a.success||(this.data.trackedDownloads[c.linkId][d]=!1)},this,null,"POST"))},_getDisplayedPublication:function(){var a=this.get("container"),b=a.one(".js-publication-version-select option:checked"),c=null;if(b&&(c=b.getData("link-id")),c){var d=this.data.displayableLinks.filter(function(a){return a.linkId==c});return d[0]?d[0]:this.data.defaultLinkData}return this.data.defaultLinkData}},{ATTRS:{showFulltextDownloadedSignupDialog:{value:!0},preSignUpDialogContext:{},requestFulltext:{}}})},"1.0.0",{requires:["rg.core.form.RgChosen","rg.core.layout.ResponsiveHelpers","rg-sticky-header-plugin","rg-overlay-extension"]});
"use strict";YUI.add("rg.views.application.BaseShareView",function(a){a.namespace("rg.views.application"),a.rg.views.application.BaseShareView=a.Base.create("application.BaseShareView",a.rg.WidgetView,[],{events:{".js-share-item":{click:"share"}},afterRendered:function(){var b="";this.data.useUtmTags&&(b="?utm_source="+this.data.utmSource+encodeURIComponent("&")+"utm_medium="+this.data.utmMedium+encodeURIComponent("&")+"utm_campaign="+this.data.utmCampaign),this.data.toShare={url:a.one('meta[property="og:url"]')._node.content+b,title:a.one('meta[property="og:title"]')._node.content}},share:function(b){this.data.trackClick&&a.rg.ajax(this.data.trackUrl,{type:this.data.name});var c=b.currentTarget.getData(),d=Hogan.compile(c.url,{},"url_template.html"),e=d.render(this.getShareData());e=this.prepareShareUrl(e);var f="width="+c.width+",height="+c.height;window.open(e,"newwindow",f)},getShareData:function(){return this.data.toShare},prepareShareUrl:function(a){return a}},{ATTRS:{}})},"1.0.0",{requires:["Hogan"]});
